<?php
require "header2.php";
?>
<?php
echo '<div id="form-rapper">';
echo '<form method="post" action="/scripts/addSection.php">';

$select1 = $conn->prepare("SELECT c_name FROM Course ORDER BY c_name ASC");
$succ1 = $select1->execute();
//echo "I did this <br>";
$courses =  $select1->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($courses[0]);
//echo $courses[0];

$select2 = $conn->prepare("SELECT course_id FROM Course ORDER BY c_name ASC");
$succ2 = $select2->execute();
//echo "I did this <br>";
$courseID =  $select2->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($courseID[0]);
//echo $courseID[0];

echo '<p><label>Course Name:</label>';
echo '<select name="CourseName">';
        for($i=0;$i<count($courses);$i++)
        {
                echo "<option value=".$courseID[$i].">".$courses[$i]."</option>";
        }
echo '</select></p>';

$select3 = $conn->prepare("SELECT DISTINCT period FROM timeslot;");
$succ3 = $select3->execute();
//echo "I did this <br>";
$times =  $select3->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($times[0]);
//echo $times[0];

echo '<p><label>Times:</label>';
echo '<select name="Times">';
        for($i=0;$i<count($times);$i++)
        {
                echo "<option value=".$times[$i].">".$times[$i]."</option>";
        }
echo '</select></p>';

$select4 = $conn->prepare("SELECT DISTINCT day FROM timeslot");
$succ4 = $select4->execute();
//echo "I did this <br>";
$days =  $select4->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($days[0]);
//echo $days[0];

echo '<p><label>Days:</label>';
echo '<select name="Days">';
        for($i=0;$i<count($days);$i++)
        {
                echo "<option value=".$days[$i].">".$days[$i]."</option>";
        }
echo '</select></p>';

$select5 = $conn->prepare("SELECT r_num FROM Room ORDER BY r_num ASC");
$succ5 = $select5->execute();
//echo "I did this <br>";
$rooms =  $select5->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($rooms[0]);
//echo $rooms[0];

$select6 = $conn->prepare("SELECT building.b_name FROM Room,Building WHERE build_id = rbuild_id ORDER BY r_num ASC;");
$succ6 = $select6->execute();
//echo "I did this <br>";
$buildings =  $select6->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($buildings[0]);
//echo $buildings[0];

$select7 = $conn->prepare("SELECT room_id FROM Room ORDER BY room_num ASC");
$succ7 = $select7->execute();
//echo "I did this <br>";
$roomID =  $select7->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($roomID[0]);
//echo $roomID[0];

echo '<p><label>Room:</label>';
echo '<select name="Room">';
        for($i=0;$i<count($rooms);$i++)
        {
                echo "<option value=".$roomID[$i].">".$rooms[$i]." ".$buildings[$i]."</option>";
        }
echo '</select></p>';

$select8 = $conn->prepare("SELECT first_name FROM Person,Faculty WHERE facu_id = user_id;");
$succ8 = $select8->execute();
//echo "I did this <br>";
$firstNames =  $select8->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($firstNames[0]);
//echo $firstNames[0];

$select9 = $conn->prepare("SELECT last_name FROM Person,Faculty WHERE facu_id = user_id;");
$succ9 = $select9->execute();
//echo "I did this <br>";
$lastNames =  $select9->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($lastNames[0]);
//echo $lastNames[0];

$select10 = $conn->prepare("SELECT facu_id FROM Faculty");
$succ10 = $select10->execute();
//echo "I did this <br>";
$instructorID =  $select10->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($instructorID[0]);
//echo $instructorID[0];

echo '<p><label>Instructor:</label>';
echo '<select name="Instructor">';
        for($i=0;$i<count($lastNames);$i++)
        {
                echo "<option value=".$instructorID[$i].">".$firstNames[$i]." ".$lastNames[$i]."</option>";
        }
echo '</select></p>';

$select11 = $conn->prepare("SELECT year FROM masterschedule ORDER BY year ASC");
$succ11 = $select11->execute();
//echo "I did this <br>";
$years =  $select11->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($years[0]);
//echo $years[0];

$select12 = $conn->prepare("SELECT semesters FROM masterschedule ORDER BY year ASC");
$succ12 = $select12->execute();
//echo "I did this <br>";
$semesters =  $select12->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($semesters[0]);
//echo $semesters[0];

$select13 = $conn->prepare("SELECT semesteryear_id FROM masterschedule ORDER BY year ASC");
$succ13 = $select13->execute();
//echo "I did this <br>";
$masterscheduleID =  $select13->fetchALL(PDO::FETCH_COLUMN,0);
//var_dump($masterscheduleID[0]);
//echo $masterscheduleID[0];

echo '<p><label>Semester:</label>';
echo '<select name="Semester">';
        for($i=0;$i<count($masterscheduleID);$i++)
        {
                echo "<option value=".$masterscheduleID[$i].">".$years[$i]." ".$semesters[$i]."</option>";
        }
echo '</select></p>';

echo '<p><label>Section:</label>';
echo '<select name="Section">';
echo "<option value=1>1</option>";
echo "<option value=2>2</option>";
echo '</select></p>';

echo '<button type="submit" id="submitButton">Submit</button>';
//echo '</form></div>';

        if(isset($_POST['CourseName']))
        {
                $courseInputed = $_POST['CourseName'];
                $flag1 = true;
                //echo $courseInputed;
        }
        else
        {
                //echo "Invalid Course Name<br>";
                $flag1 = false;
        }
        if(isset($_POST['Semester']))
        {
                $semesterInputed = $_POST['Semester'];
                $flag2 = true;
                //echo $semesterInputed;
        }
        else
        {
                //echo "Invalid Semester <br>";
                $flag2 = false;
        }
        if(isset($_POST['Times']))
        {
                $timesInputed = $_POST['Times'];
                $flag3 = true;
                //echo $timesInputed;
        }
        else
        {
                //echo "Invalid Time <br>";
                $flag3 = false;
        }
        if(isset($_POST['Days']))
        {
                $daysInputed = $_POST['Days'];
                $flag4 = true;
                //echo $daysInputed;
        }
        else
        {
                //echo "Invalid Day <br>";
                $flag4 = false;
        }
        if(isset($_POST['Room']))
        {
                $roomInputed = $_POST['Room'];
                $flag5 = true;
                //echo $roomInputed;
        }
        else
        {
                //echo "Invalid room<br>";
                $flag5 = false;
        }
        if(isset($_POST['Instructor']))
        {
                $instructorInputed = $_POST['Instructor'];
                $flag6 = true;
                //echo $instructorInputed;
        }
        else
        {
                //echo "Invalid Instructor <br>";
                $flag6 = false;
        }
       if(isset($_POST['Section']))
        {
                $sectionInputed = $_POST['Instructor'];
                $flag7 = true;
                //echo $sectionInputed;
        }
        else
        {
                //echo "Invalid Instructor <br>";
                $flag7 = false;
        }

        if($flag1 && $flag2 && $flag3 && $flag4 && $flag5 && $flag6 && $flag7)
        {
                //echo "made it <br>";

                $select14 = $conn->prepare("SELECT timeslotid FROM timeslot WHERE period = ? AND day = ? ");
                $select14->bindParam(1,$timesInputed);
                $select14->bindParam(2,$daysInputed);
                $succ14 = $select14->execute();
                //echo "I did this <br>";
                $slotID = $select10->fetchALL(PDO::FETCH_COLUMN,0);
                //var_dump($slotID[0]);
                //echo $slotID[0];

                $select15 = $conn->prepare("SELECT rbuild_id FROM room WHERE room_id  = ?");
                $select15->bindParam(1,$roomInputed);
                $succ15 = $select15->execute();
                //echo "I did this <br>";
                $buildingID =  $select15->fetchALL(PDO::FETCH_COLUMN,0);
                //var_dump($$buildingID[0]);
                //echo $$buildingID[0];

                $select16 = $conn->prepare("SELECT MAX(s_section_id) FROM section;");
                $succ16 = $select16->execute();
                //echo "I did this <br>";
                $maxSectionID =  $select16->fetchALL(PDO::FETCH_COLUMN,0);
                //var_dump($maxSectionID[0]);
                //echo $maxSectionID[0];
                $sectionID = $maxSectionID[0] + 1;

                $insert1 = $conn->prepare("INSERT INTO Section VALUES(?,?,?,?,?,?,?,?)");
                $insert1->bindParam(1,$sectionID);
                $insert1->bindParam(2,$instructorInputed);
                $insert1->bindParam(3,$courseInputed);
                $insert1->bindParam(4,$buildingID);
                $insert1->bindParam(5,$semesterInputed);
                $insert1->bindParam(6,$slotID[0]);
                $insert1->bindParam(7,$roomInputed);
                $insert1->bindParam(8,$sectionInputed);
                $sectionAdded = $insert1->execute();

                if($sectionAdded)
                {
                        //echo "Inserted <br>";
                        //propably add a pop up box stating that it was done sucessfully
                        //header('Location: ../addSection.php');
                }
                else
                {
                        //echo "Not inserted <br>";
                }
        }
        else
        {
                //echo "Something went wrong";
                //header('Location: ../addSection.php');
        }

?>
<br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br></br><br$
<?php
require "footer.php";
?>